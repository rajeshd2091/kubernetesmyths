"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[8510],{8453:(e,s,t)=>{t.d(s,{R:()=>l,x:()=>i});var n=t(6540);const r={},o=n.createContext(r);function l(e){const s=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),n.createElement(o.Provider,{value:s},e.children)}},8898:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"k8s-core-myths/workload-myths/Deployment_Supports_All_Pod_Restart_Policies","title":"Myth: Deployment Supports All Pod Restart Policies","description":"Can You Use Any Restart Policy in a Deployment?","source":"@site/docs/k8s-core-myths/workload-myths/Deployment_Supports_All_Pod_Restart_Policies.md","sourceDirName":"k8s-core-myths/workload-myths","slug":"/k8s-core-myths/workload-myths/Deployment_Supports_All_Pod_Restart_Policies","permalink":"/k8s-core-myths/workload-myths/Deployment_Supports_All_Pod_Restart_Policies","draft":false,"unlisted":false,"editUrl":"https://github.com/kubernetes-myths/website/blob/main/docs/k8s-core-myths/workload-myths/Deployment_Supports_All_Pod_Restart_Policies.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"k8sCoreMythsSidebar","previous":{"title":"Myth: DaemonSet always schedule pods on all nodes.","permalink":"/k8s-core-myths/workload-myths/DaemonSet_always_schedule_pods_on_all_nodes"},"next":{"title":"Myth: Kubernetes Automatically Roll Back Failed Deployment","permalink":"/k8s-core-myths/workload-myths/Kubernetes_automatically_roll_back_failed_deployment"}}');var r=t(4848),o=t(8453);const l={sidebar_position:5},i="Myth: Deployment Supports All Pod Restart Policies",a={},d=[{value:"Why This Myth Exists?",id:"why-this-myth-exists",level:3},{value:"The Reality:",id:"the-reality",level:3},{value:"Experiment &amp; Validate",id:"experiment--validate",level:3},{value:"Key Takeaways",id:"key-takeaways",level:3}];function c(e){const s={code:"code",h1:"h1",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"myth-deployment-supports-all-pod-restart-policies",children:"Myth: Deployment Supports All Pod Restart Policies"})}),"\n",(0,r.jsxs)(s.p,{children:["Can You Use Any Restart Policy in a Deployment?\r\nMany believe that Deployments can be used with any Kubernetes Pod restart policy. The assumption is that you can define ",(0,r.jsx)(s.code,{children:"Always"}),", ",(0,r.jsx)(s.code,{children:"OnFailure"}),", or ",(0,r.jsx)(s.code,{children:"Never"})," as the restartPolicy within a Deployment\u2019s Pod spec.But that's not true."]}),"\n",(0,r.jsx)(s.h3,{id:"why-this-myth-exists",children:"Why This Myth Exists?"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["Pods support all three restart policies (",(0,r.jsx)(s.code,{children:"Always"}),", ",(0,r.jsx)(s.code,{children:"OnFailure"}),", ",(0,r.jsx)(s.code,{children:"Never"}),"), leading to the assumption that Deployments do as well."]}),"\n",(0,r.jsx)(s.li,{children:"Users often assume Pod behavior is the same inside different controllers like Deployments, DaemonSets, or Jobs."}),"\n",(0,r.jsx)(s.li,{children:"The Kubernetes API allows specifying other restart policies in Pod definitions, but Deployments override them!"}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"the-reality",children:"The Reality:"}),"\n",(0,r.jsxs)(s.p,{children:["Deployment = ",(0,r.jsx)(s.code,{children:"restartPolicy: Always"})," Only!\r\nIn Kubernetes, Deployments are designed to manage long-running applications. That means:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"If a Pod fails, Kubernetes restarts it."}),"\n",(0,r.jsx)(s.li,{children:"If a node crashes, a new Pod is scheduled on another node."}),"\n",(0,r.jsx)(s.li,{children:"Any restart policy other than Always is rejected!"}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"experiment--validate",children:"Experiment & Validate"}),"\n",(0,r.jsxs)(s.p,{children:["Let\u2019s try using ",(0,r.jsx)(s.code,{children:"restartPolicy: OnFailure"})," inside a Deployment and see what happens:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:'apiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: my-deployment\r\nspec:\r\n  replicas: 3\r\n  selector:\r\n    matchLabels:\r\n      app: test-app\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: test-app\r\n    spec:\r\n      restartPolicy: OnFailure\r\n      containers:\r\n      - name: test-container\r\n        image: busybox\r\n        command: ["sh", "-c", "echo Hello && exit 1"]\n'})}),"\n",(0,r.jsxs)(s.p,{children:["What Happens?\r\nDeployment rejects ",(0,r.jsx)(s.code,{children:"OnFailure"})," and throw an error!"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:'The Deployment "my-deployment" is invalid: spec.template.spec.restartPolicy: Unsupported value: "OnFailure": supported values: "Always"\n'})}),"\n",(0,r.jsxs)(s.p,{children:["Kubernetes rejects the Deployment, as it does not allow restart policies other than ",(0,r.jsx)(s.code,{children:"Always"}),"."]}),"\n",(0,r.jsx)(s.h3,{id:"key-takeaways",children:"Key Takeaways"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Deployments only support"})," ",(0,r.jsx)(s.code,{children:"restartPolicy: Always"}),"\u2014other policies are rejected."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Use Jobs or CronJobs for"})," ",(0,r.jsx)(s.code,{children:"OnFailure"})," or ",(0,r.jsx)(s.code,{children:"Never"})," ",(0,r.jsx)(s.strong,{children:"restart behavior."})]}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.strong,{children:"Understanding controller-specific behavior prevents misconfigurations."})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);