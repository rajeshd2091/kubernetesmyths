"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[1215],{3924:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>a,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"k8s-core-myths/scheduling-myths/Pod_memory_requests_are_only_used_for_scheduling","title":"Myth: Pod memory requests are only used for scheduling","description":"During an incident review, a team noticed that several Pods were evicted even though they were well below their configured memory limits.","source":"@site/docs/k8s-core-myths/scheduling-myths/Pod_memory_requests_are_only_used_for_scheduling.md","sourceDirName":"k8s-core-myths/scheduling-myths","slug":"/k8s-core-myths/scheduling-myths/Pod_memory_requests_are_only_used_for_scheduling","permalink":"/k8s-core-myths/scheduling-myths/Pod_memory_requests_are_only_used_for_scheduling","draft":false,"unlisted":false,"editUrl":"https://github.com/kubernetes-myths/website/blob/main/docs/k8s-core-myths/scheduling-myths/Pod_memory_requests_are_only_used_for_scheduling.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"k8sCoreMythsSidebar","previous":{"title":"Myth: Kubernetes Has a Concept of Node Anti-Affinity","permalink":"/k8s-core-myths/scheduling-myths/Kubernetes_Has_a_Concept_of_Node_Anti-Affinity"}}');var i=s(4848),t=s(8453);const o={sidebar_position:5},l="Myth: Pod memory requests are only used for scheduling",d={},c=[{value:"Why This Myth Exists?",id:"why-this-myth-exists",level:3},{value:"The Reality",id:"the-reality",level:3},{value:"Experiment &amp; Validate",id:"experiment--validate",level:3},{value:"Key Takeaways",id:"key-takeaways",level:3}];function h(e){const n={code:"code",em:"em",h1:"h1",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"myth-pod-memory-requests-are-only-used-for-scheduling",children:"Myth: Pod memory requests are only used for scheduling"})}),"\n",(0,i.jsx)(n.p,{children:"During an incident review, a team noticed that several Pods were evicted even though they were well below their configured memory limits."}),"\n",(0,i.jsx)(n.p,{children:"The immediate conclusion was:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"\u201cThe node must have run out of memory, and Kubernetes killed random Pods.\u201d"})}),"\n",(0,i.jsx)(n.p,{children:"In a follow-up discussion, someone confidently said:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"\u201cMemory requests are only used by the scheduler. At runtime, only limits matter.\u201d"})}),"\n",(0,i.jsx)(n.p,{children:"This belief is common in interviews, architecture discussions, and even production design decisions."}),"\n",(0,i.jsx)(n.p,{children:"Unfortunately, it leads to fragile workloads and hard-to-explain evictions."}),"\n",(0,i.jsx)(n.h3,{id:"why-this-myth-exists",children:"Why This Myth Exists?"}),"\n",(0,i.jsx)(n.p,{children:"This myth exists because of several subtle but reinforcing factors:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Scheduler-focused learning"}),"\n",(0,i.jsx)(n.p,{children:"Most Kubernetes explanations introduce memory requests in the context of scheduling and stop there."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"CPU behavior confusion"}),"\n",(0,i.jsx)(n.p,{children:"CPU requests and limits influence throttling, not eviction, which makes engineers assume memory behaves similarly."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Limits feel more \u201creal\u201d"}),"\n",(0,i.jsx)(n.p,{children:"Memory limits cause OOMKills, which are visible and immediate, while eviction logic is less obvious."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Eviction logic lives in kubelet internals"}),"\n",(0,i.jsx)(n.p,{children:"The role of memory requests during node pressure is not emphasized in high-level documentation."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"the-reality",children:"The Reality"}),"\n",(0,i.jsx)(n.p,{children:"Pod memory requests are not only used for scheduling."}),"\n",(0,i.jsx)(n.p,{children:"They are also used at runtime by the kubelet during node-level memory pressure to decide which Pods to evict."}),"\n",(0,i.jsx)(n.p,{children:"When a node experiences memory pressure:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The kubelet evaluates Pods based on their QoS class"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"For Burstable Pods, it considers actual memory usage relative to the requested memory"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Pods that exceed their memory requests are more likely to be evicted"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"In other words:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Memory requests act as eviction contracts, not just scheduling inputs."})}),"\n",(0,i.jsx)(n.p,{children:"Exceeding a memory request does nothing by itself."}),"\n",(0,i.jsx)(n.p,{children:"But exceeding it during node memory pressure significantly increases eviction risk."}),"\n",(0,i.jsx)(n.h3,{id:"experiment--validate",children:"Experiment & Validate"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Step 1: Create two Burstable Pods with different requests"})}),"\n",(0,i.jsx)(n.p,{children:"Pod A \u2013 low request, moderate usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-low-request\r\nspec:\r\n  containers:\r\n  - name: stress\r\n    image: polinux/stress\r\n    resources:\r\n      requests:\r\n        memory: "128Mi"\r\n      limits:\r\n        memory: "1Gi"\r\n    args:\r\n    - "--vm"\r\n    - "1"\r\n    - "--vm-bytes"\r\n    - "500M"\r\n    - "--vm-hang"\r\n    - "1"\r\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"Pod B \u2013 high request, higher usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: pod-high-request\r\nspec:\r\n  containers:\r\n  - name: stress\r\n    image: polinux/stress\r\n    resources:\r\n      requests:\r\n        memory: "1Gi"\r\n      limits:\r\n        memory: "2Gi"\r\n    args:\r\n    - "--vm"\r\n    - "1"\r\n    - "--vm-bytes"\r\n    - "900M"\r\n    - "--vm-hang"\r\n    - "1"\r\n\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Step 2: Artificially create node memory pressure"})}),"\n",(0,i.jsx)(n.p,{children:"Now we force node-level memory pressure."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: node-memory-hog\r\nspec:\r\n  containers:\r\n  - name: hog\r\n    image: polinux/stress\r\n    resources:\r\n      requests:\r\n        memory: "2Gi"\r\n      limits:\r\n        memory: "2Gi"\r\n    args:\r\n    - "--vm"\r\n    - "1"\r\n    - "--vm-bytes"\r\n    - "2G"\r\n    - "--vm-hang"\r\n    - "1"\r\n\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Step 3: Observe node condition"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"kubectl describe node | grep -A5 MemoryPressure\n"})}),"\n",(0,i.jsx)(n.p,{children:"You should see:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"MemoryPressure   True\n"})}),"\n",(0,i.jsx)(n.p,{children:"This is the trigger condition for eviction logic."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Step 4: Watch pod eviction"})}),"\n",(0,i.jsx)(n.p,{children:"Run:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"kubectl get pods -w\n"})}),"\n",(0,i.jsx)(n.p,{children:"Within seconds:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"pod-low-request gets evicted first"}),"\n",(0,i.jsx)(n.li,{children:"pod-high-request keeps running"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Check details:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"kubectl describe pod pod-low-request\n"})}),"\n",(0,i.jsx)(n.p,{children:"You\u2019ll see:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"Reason: Evicted\r\nMessage: The node was low on resource: memory.\r\n\n"})}),"\n",(0,i.jsx)(n.h3,{id:"key-takeaways",children:"Key Takeaways"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Memory requests are not just scheduling hints."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"At runtime, memory requests influence eviction priority during node pressure."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Low memory requests combined with high usage increase eviction risk."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Memory limits control OOMKills; memory requests influence evictions."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Stable production workloads require realistic memory requests, not minimal ones."}),"\n"]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);